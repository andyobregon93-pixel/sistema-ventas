<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Panel Profesional</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{background:#0f172a;color:white}
.card{border-radius:15px}
</style>
</head>
<body class="p-3">

<div id="login">
<div class="card p-4 text-dark">
<h3>Acceso Administrativo</h3>
<input type="password" id="clave" class="form-control mb-2" placeholder="Ingrese contraseña">
<button class="btn btn-dark w-100" onclick="verificar()">Entrar</button>
</div>
</div>

<div id="sistema" style="display:none">

<h2>Dashboard Ventas</h2>

<div class="row mt-3">
<div class="col-6">
<div class="card p-3 text-dark">
<h5>Total Ventas</h5>
<h3 id="totalGeneral">$0</h3>
</div>
</div>

<div class="col-6">
<div class="card p-3 text-dark">
<h5>Cantidad</h5>
<h3 id="cantidadVentas">0</h3>
</div>
</div>
</div>

<hr>

<div class="card p-3 text-dark">
<h5>Nueva Venta</h5>
<input id="cliente" class="form-control mb-2" placeholder="Cliente">
<input id="producto" class="form-control mb-2" placeholder="Producto">
<input id="precio" type="number" class="form-control mb-2" placeholder="Precio">

<select id="metodo" class="form-control mb-2">
<option>Efectivo</option>
<option>Transferencia</option>
<option>Tarjeta</option>
<option>Cripto</option>
</select>

<button class="btn btn-success w-100" onclick="guardar()">Guardar Venta</button>
</div>

<hr>

<h5>Historial</h5>
<table class="table table-dark">
<tbody id="tabla"></tbody>
</table>

</div>

<script>
const PASSWORD="2020";

function verificar(){
if(document.getElementById("clave").value===PASSWORD){
document.getElementById("login").style.display="none";
document.getElementById("sistema").style.display="block";
}else{
alert("Contraseña incorrecta");
}
}

let ventas=JSON.parse(localStorage.getItem("ventas"))||[];
let factura=localStorage.getItem("factura")||1000;

function guardar(){
let c=document.getElementById("cliente").value;
let p=document.getElementById("producto").value;
let pr=parseFloat(document.getElementById("precio").value);
let m=document.getElementById("metodo").value;

let iva=pr*0.16;
let total=pr+iva;

ventas.push({c,p,pr,iva,total,m});
localStorage.setItem("ventas",JSON.stringify(ventas));
mostrar();
}

function mostrar(){
let tabla=document.getElementById("tabla");
tabla.innerHTML="";
let totalGeneral=0;

ventas.forEach((v,i)=>{
totalGeneral+=v.total;

tabla.innerHTML+=`
<tr>
<td>${v.c}</td>
<td>$${v.total.toFixed(2)}</td>
<td>
<button class="btn btn-warning btn-sm" onclick="verFactura(${i})">PDF</button>
</td>
</tr>`;
});

document.getElementById("totalGeneral").innerText="$"+totalGeneral.toFixed(2);
document.getElementById("cantidadVentas").innerText=ventas.length;
}

async function verFactura(i){
const { jsPDF } = window.jspdf;
let doc=new jsPDF();

let v=ventas[i];

doc.text("Factura Nº "+factura,20,20);
doc.text("Cliente: "+v.c,20,30);
doc.text("Producto: "+v.p,20,40);
doc.text("Subtotal: $"+v.pr,20,50);
doc.text("IVA: $"+v.iva.toFixed(2),20,60);
doc.text("Total: $"+v.total.toFixed(2),20,70);

doc.save("factura_"+factura+".pdf");

factura++;
localStorage.setItem("factura",factura);
}

mostrar();
</script>

</body>
  </html>
